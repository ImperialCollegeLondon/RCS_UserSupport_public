

## Paraview off-screen rendering of images

this mini-guide will absolve the need of having something that allows you to print "off-screen" i.e. without starting Xserver sessions
(this work well on remote compute nodes via jobs-submission).

to achieve this:  

-  use **paraview macro builder** from the GUI to generate the python macro/code for your current model
- to generate the images, use `pvbatch` in a job-script, pointing to the python code you created at the previous step (see example below)


**NOTES :**   
The examples we were able to run are those that use the `SaveScreenshot()` function generated by the macro builder.  

I haven't yet managed to run examples based on the `PVsnapshot` function, but I am afraid it cannot be easily run "headless"/"off-screen without a monitor/Xserver".  

---

### Example 1:

`ssh login.hpc.ic.ac.uk`

write a job-script and use the `pvbatch` command as below to print out the images :

```
#PBS ...
#PBS ...

module load paraview/5.8.0

cd $PBS_O_WORKDIR

pvbatch --force-offscreen-rendering <macro-file_geom1.py>
pvbatch --force-offscreen-rendering <macro-file_geom2.py>

```

- `macro-file_\*.py` are those built from **paraview GUI macro builder**    
- `module load paraview/5.8.0` will load the SW from the HPC installation (this is compiled with **osmesa** support -- i.e. for doing the graphics printouts on the CPUs without needing the GPUs.)  

submit your printing script in a batch job as usual.


#### check the images generated  


- either copy the images to your workstation and display them locally

OR

- display the images remotely, by running, in another terminal :  

  `ssh -X login.hpc.ic.ac.uk`

  make sure you have a working X11 by typing : `echo $DISPLAY`  
  > this command should return some "not-null" value (example: `localhost:43.0`)

  > **IMPORTANT :** please do NOT fiddle with this variable NOR set it manually if it is NOT automatically set by the system upon `ssh -X` login.

  cd into your folder with the images and run :

  `eog -w imagename.png`

  wait a few seconds (depending on network and FS lags) and an image should pop up in a new window through a remote connection.

Please bear in mind that this windows is generated from the HPC not your local computer so it could be slow to monipulate/rotate etc.. and doing Menu ops "save/load" will point to your remote storage, not the local hard-disk.



---
CAVEATS:

things may work well/better when using **paraview "on-screen" rendering** directly from/on the login nodes (i.e. with `ssh -X loginnode` and a `$DISPLAY` set there)

We **DO NOT** allow working in such a way for a prolonged time, and this method is not easy to setup on remote compute nodes, without using some advanced tricks; so this is highly discouraged.





